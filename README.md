พิชิตการ Deploy และทดสอบ API ด้วย Docker Compose (ฉบับ FastAPI!)
จงฟังให้ดี เหล่านักผจญภัย! นี่คือแนวทางในการปลุกเสก API สองตัว ให้มีชีวิตขึ้นมาด้วยพลังของ Docker Compose และเวทมนตร์แห่ง FastAPI! พวกมันจะสื่อสารกันราวกับโทรจิตเลยเชียวล่ะ!

ผังสมบัติของโปรเจกต์
api-proxy-example-fastapi/
├── api1/                 # ดินแดนของประตูมิติ
│   ├── main.py           # หัวใจของประตูมิติ
│   ├── Dockerfile        # พิมพ์เขียวสำหรับการสร้างประตูมิติ
│   └── requirements.txt  # รายการเครื่องมือที่ประตูมิติใช้
├── api2/                 # ดินแดนของผู้คุมคลังข้อมูล
│   ├── main.py           # หัวใจของผู้คุมคลังข้อมูล
│   ├── Dockerfile        # พิมพ์เขียวสำหรับการสร้างผู้คุมคลังข้อมูล
│   └── requirements.txt  # รายการเครื่องมือที่ผู้คุมคลังข้อมูลใช้
├── docker-compose.yml    # แผนผังสำหรับเรือเหาะแห่งการ Deploy
└── README.md             # ม้วนคัมภีร์อธิบายทั้งหมด


สิ่งที่ต้องมีก่อนเริ่มการผจญภัย (Prerequisites)
Docker Desktop หรือ Docker Engine ที่ได้รับการติดตั้งและพร้อมใช้งานบนเครื่องคอมพิวเตอร์ของท่าน!

วิธีการ Deploy กองทัพ API!
โคลนคัมภีร์ศักดิ์สิทธิ์ (Clone Repository):
จงร่ายคาถา!

git clone https://github.com/<ชื่อผู้ใช้ของท่าน>/api-proxy-example-fastapi.git
cd api-proxy-example-fastapi


(อย่าลืมสร้างคลังสมบัติของท่านบน GitHub/GitLab เองนะ!)

ปลุกเสกและออกเดินทางด้วยเรือเหาะ (Build และรัน Docker Containers):
ในดินแดน api-proxy-example-fastapi ที่มีม้วนคัมภีร์ docker-compose.yml วางอยู่ จงร่ายคาถาอันศักดิ์สิทธิ์นี้:

docker-compose up --build -d


--build: คาถาที่จะสร้างสิ่งใหม่จากพิมพ์เขียว Dockerfile!

-d: คาถาที่จะทำให้กองทัพทำงานอย่างลับๆ ในเบื้องหลัง!

ท่านจะเห็นบันทึกการก่อกำเนิดของกองทัพแสดงขึ้นมา!

วิธีการทดสอบพลังแห่ง API!
ตรวจสอบสถานะของนักรบ (ตรวจสอบสถานะ Containers):
ท่านสามารถตรวจสอบว่านักรบของเราพร้อมรบหรือไม่ด้วยคาถานี้:

docker-compose ps


ท่านควรจะเห็น api1 และ api2 อยู่ในสถานะ Up ซึ่งหมายถึงพวกเขากำลังปฏิบัติหน้าที่อยู่!

เข้าสู่ประตูมิติ API 1 (Gateway API):

เปิดหน้าต่างแห่งโลกอินเทอร์เน็ต (Web Browser) หรือใช้ดาบคำสั่ง curl เพื่อทะลวงเข้าสู่ประตูมิติ API 1 ที่ พอร์ต 5000

จุดนัดพบหลัก:

URL: http://localhost:5000/

ผลลัพธ์ที่คาดหวัง: หน้าจอ HTML แสดง "สวัสดีจาก API 1!" พร้อมกับลิงก์สู่ภารกิจลับที่ /proxy-hello

ท่านจะเห็นบันทึกในสมุด api1 ว่าได้รับคำขอแล้ว!

ภารกิจลับที่ส่งต่อให้ API 2:

URL: http://localhost:5000/proxy-hello

ผลลัพธ์ที่คาดหวัง: ข้อความ JSON {"message": "สารลับจาก API 2 ผ่านทาง API 1: สวัสดีจาก API 2!"}

เมื่อท่านเข้าสู่ภารกิจนี้:

ท่านจะเห็นบันทึกในสมุด api1 ว่ากำลังส่งต่อสารลับและได้รับคำตอบกลับมา!

ท่านจะเห็นบันทึกในสมุด api2 ว่าได้รับสารลับและส่งคำตอบกลับไป!

ส่องดูบันทึกการเดินทาง (ดู Logs ของ Containers):
หากต้องการดูทุกเหตุการณ์ที่เกิดขึ้นแบบเรียลไทม์ จงร่ายคาถา:

docker-compose logs -f


ท่านจะเห็นทุกสิ่งที่ api1 และ api2 ได้กระทำ!

การยุบกองทัพและการทำลายล้าง Containers!
เมื่อภารกิจเสร็จสิ้น ท่านสามารถยุบกองทัพและเก็บกวาดทุกอย่างที่ Docker Compose สร้างขึ้นด้วยคาถานี้:

docker-compose down


คาถานี้จะหยุดและทำลายเรือเหาะ กองทัพ และทุกสิ่งทุกอย่างที่เกี่ยวข้องกับโปรเจกต์นี้!
